# Проект детекции людей на видео

## Описание

Этот проект предназначен для детекции людей на видео с использованием предобученной модели YOLO11x.  Программа написана на Python с использованием библиотеки Ultralytics YOLO.

## Установка

1. **Клонирование репозитория:**

   ```bash
   git clone https://github.com/maxlyara1/crowd_detection_task
   cd crowd_detection_task
   ```

2. **Создание и активация виртуального окружения:**

   *   **Windows:**

      ```bash
      python -m venv venv
      venv\Scripts\activate
      ```

   *   **macOS / Linux:**

      ```bash
      python3 -m venv venv
      source venv/bin/activate
      ```
      Команда `python3` может отличаться в зависимости от вашей системы. Используйте `python` если `python3` не найдена.

3. **Установка зависимостей:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Размещение видеофайла**

    Поместите видеофайл `crowd.mp4` в ту же директорию, где находится скрипт `main.py`.

## Запуск

```bash
python main.py
```

После выполнения программы в той же директории будет создан файл `output.mp4` с результатами детекции.  Не забудьте активировать виртуальное окружение перед запуском (`venv\Scripts\activate` на Windows, `source venv/bin/activate` на macOS/Linux).

## Структура проекта

-   `main.py`:  Основной скрипт, содержащий точку входа и логику обработки видео.
-   `requirements.txt`:  Список зависимостей проекта.
-   `README.md`:  Описание проекта, инструкция по установке и запуску.
-   `crowd.mp4`: Входной видеофайл (необходимо предоставить).
-   `output.mp4`: Выходной видеофайл (генерируется программой).
-   `yolo11x.pt`: файл с предобученными весами (скачивается автоматически при первом запуске, если отсутствует)
-   `venv`: Директория виртуального окружения (создается при установке).

## Анализ качества распознавания и шаги по улучшению

**(Содержание анализа и шагов по улучшению осталось без изменений, так как оно не относится к созданию venv):**

**Текущие результаты:**

1.  **Хорошая общая производительность:** YOLO11x, как и ожидалось от модели "x", демонстрирует хорошее качество обнаружения объектов (людей) на видео. Большинство людей детектируются корректно.
2.  **Скорость обработки:**  Скорость обработки достаточна для данного видео, но на более длинных и сложных видео может потребоваться оптимизация для real-time обработки.
3.  **Проблемы с перекрытием:** В сценах с высокой плотностью толпы возникают проблемы с перекрытием объектов.  Некоторые люди могут быть частично или полностью закрыты другими, что приводит к пропускам детекции или неточным ограничивающим рамкам.
4.  **Ложные срабатывания:**  В редких случаях возможны ложные срабатывания (объекты, не являющиеся людьми, детектируются как люди).
5.  **Нестабильность детекции:** На некоторых кадрах детекция может "мерцать" - один и тот же человек может то появляться, то исчезать из детекции.

**Шаги по улучшению:**

1.  **Тонкая настройка (Fine-tuning) на специфичном датасете:**
    *   **Наиболее важный шаг.**  Если есть возможность, необходимо собрать датасет, максимально похожий на целевые условия использования (освещение, ракурс камеры, плотность толпы).  Дообучение (fine-tuning) предобученной модели YOLO11x на этом датасете *значительно* повысит точность и надежность.
    *   Разметка должна быть максимально точной, чтобы минимизировать ошибки обучения.

2.  **Увеличение разрешения входного видео (если возможно):**
    *   Более высокое разрешение может помочь модели лучше различать мелкие детали и, следовательно, улучшить детекцию людей, находящихся на большом расстоянии от камеры.  Однако это увеличит вычислительные затраты.

3.  **Использование трекинга:**
    *   Внедрение алгоритмов трекинга (например, DeepSORT, ByteTrack) позволит отслеживать людей между кадрами.  Это поможет:
        *   Справиться с проблемой "мерцания" детекции.
        *   Улучшить идентификацию людей при перекрытии.
        *   Присвоить каждому человеку уникальный ID, что полезно для подсчета людей.

4.  **Обработка перекрытий:**
    *   **Non-Maximum Suppression (NMS):**  Тщательная настройка параметров NMS (порог перекрытия) может помочь уменьшить количество дублирующихся ограничивающих рамок для одного и того же человека.
    *   **Soft-NMS:**  Рассмотреть возможность использования Soft-NMS вместо стандартного NMS. Soft-NMS не полностью подавляет bounding box'ы с перекрытием, а уменьшает их confidence score. Это может быть полезно в сценах с высокой плотностью.
    *   **Алгоритмы, специфичные для толпы:** Исследовать алгоритмы, разработанные специально для детекции людей в толпе (например, CrowdDet).

5.  **Уменьшение ложных срабатываний:**
    *   **Увеличение порога уверенности (confidence threshold):**  Увеличение `conf` в вызове `model()` может уменьшить количество ложных срабатываний, но также может привести к пропускам реальных людей.  Нужно найти оптимальный баланс.
    *   **Дополнительная классификация:**  Добавить дополнительный этап классификации, который будет фильтровать результаты YOLO. Например, обучить отдельный классификатор, который будет проверять, действительно ли изображение внутри bounding box'а содержит человека.

6.  **Оптимизация производительности (если требуется real-time обработка):**
    *   **Использовать меньшую модель YOLO:**  Если скорость обработки критична, можно попробовать использовать более легкие модели (YOLO11n, YOLO11s, YOLO11m), пожертвовав частью точности.
    *   **Квантизация:**  Преобразовать модель в формат с более низкой точностью (например, INT8). Это значительно ускорит инференс, особенно на GPU и специализированных устройствах (например, Edge TPU).
    *   **Экспорт в оптимизированные форматы:**  Экспортировать модель в форматы, оптимизированные для конкретного оборудования (ONNX, TensorRT).
    *   **Использование GPU:** Обязательно использовать GPU для инференса модели, это даст значительный прирост в скорости.
    *   **Оптимизация кода:** Профилировать код, чтобы найти узкие места, и оптимизировать их (например, векторизовать операции, где это возможно).
    *   **Пакетная обработка кадров:** Если позволяет задержка, обрабатывать несколько кадров одновременно (батчами).

7.  **Улучшенная визуализация (при необходимости):**
    *   Добавить сглаживание bounding box'ов между кадрами (например, с помощью фильтра Калмана).
    *   Отображать ID людей (если используется трекинг).

8.  **Обработка окклюзий**
    *   Использование моделей, обученных распознавать части тела. Если человек частично скрыт, модель все еще сможет его обнаружить.
    *   Использование информации о движении. Если человек двигается, то даже при частичной окклюзии его легче обнаружить.

Реализация предложенных улучшений позволит значительно повысить качество и надежность системы детекции людей на видео, делая ее более пригодной для реальных приложений. Выбор конкретных методов оптимизации зависит от требований к точности, скорости и ресурсам.
